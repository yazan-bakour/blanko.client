@using Banko.Client.Models.User
@using Banko.Client.Services.Auth
@using Microsoft.AspNetCore.Components.Routing

@inject NavigationManager NavigationManager
@inject IAuthService AuthService
@inject AuthStateProvider AuthState
@inherits LayoutComponentBase

<MudLayout Class="banko-layout d-flex">
  @if (!IsProfileRoute())
  {
    <MudAppBar Dense="false">
      <MudContainer MaxWidth="MaxWidth.Large" Class="d-flex justify-end" Gutters="false">
        <AuthorizeView>
          <Authorized>
            <MudMenu Variant="Variant.Text" Size="Size.Large" AnchorOrigin="Origin.BottomRight"
              TransformOrigin="Origin.TopRight">
              <ActivatorContent>
                <MudAvatar>
                  <MudImage Src="@context.User.FindFirst("profilePictureDisplay")?.Value" />
                </MudAvatar>
              </ActivatorContent>

              <ChildContent>
                <MudMenuItem Icon="@Icons.Material.Filled.Settings" IconColor="Color.Primary" Label="Settings"
                  Href="/profile" />

                <MudDivider />

                <MudMenuItem OnClick="@(() => HandleLogout())" ForceLoad Icon="@Icons.Material.TwoTone.Logout"
                  IconColor="Color.Primary" Label="Log out" />

              </ChildContent>
            </MudMenu>
          </Authorized>
        </AuthorizeView>
      </MudContainer>
    </MudAppBar>
  }
  <NavMenu @bind-Open="_open" />
  <MudMainContent Class="@GetMainContentClass()">
    <MudContainer MaxWidth="MaxWidth.Large">
      @Body
    </MudContainer>
  </MudMainContent>
</MudLayout>

@code {
  private bool _open = true;
  private void ToggleDrawer()
  {
    _open = !_open;
  }
  private async Task HandleLogout()
  {
    await AuthService.LogoutAsync();
    NavigationManager.NavigateTo("/login", true);
  }
  private bool IsProfileRoute()
  {
    var currentUri = NavigationManager.Uri;
    return currentUri.Contains("/profile") || currentUri.Contains("/profile/account");
  }
  private string GetMainContentClass()
  {
    return IsProfileRoute()
    ? "pb-16 ml-0 pt-4"
    : "pb-16 ml-0 pt-16";
  }
}
<style>
  .banko-layout {
    max-width: 1200px;
    margin: 0 auto;
  }

  .banko-layout>.mud-appbar {
    max-width: 1200px;
    margin: 0 auto;
  }

  .mud-popover {
    width: 200px;
  }
</style>